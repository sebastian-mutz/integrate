

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>P3-E201 &mdash; INTEGRATE 1.0 documentation</title>
  

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Project P001" href="../../projects/P001/P001_info.html" />
    <link rel="prev" title="P2-E005" href="../E105/E105.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home" alt="Documentation Home"> INTEGRATE
          

          
            
            <img src="../../_static/integrateLogo_256_256.png" class="logo" alt="Logo"/>
          
          </a>

          
            
            
              <div class="version">
                2021
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Course Information:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../general/info.html">General</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/syllabus.html">Syllabus</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/license.html">License</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general/credits.html">Credits</a></li>
</ul>
<p class="caption"><span class="caption-text">Lectures:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/info.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A001/A001.html">Building a Climate I</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A002/A002.html">Building a Climate II</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A003/A003.html">Building a Climate III</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A004/A004.html">Building a Climate IV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A005/A005.html">Building a Climate V</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A006/A006.html">Building a Climate VI</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A007/A007.html">Building a Climate VII</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lectures/A008/A008.html">Building a Climate VIII</a></li>
</ul>
<p class="caption"><span class="caption-text">Exercises:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../info.html">Intro</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E001/E001.html">P1-E001</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E002/E002.html">P1-E002</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E003/E003.html">P1-E003</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E004/E004.html">P1-E004</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E005/E005.html">P1-E005</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E101/E101.html">P2-E001</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E102/E102.html">P2-E002</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E103/E103.html">P2-E003</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E104/E104.html">P2-E004</a></li>
<li class="toctree-l1"><a class="reference internal" href="../E105/E105.html">P2-E005</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">P3-E201</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#information">Information</a></li>
<li class="toctree-l2"><a class="reference internal" href="#setting-up-the-raspberry-pi">Setting up the Raspberry Pi</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#installing-raspberry-os">Installing Raspberry OS</a></li>
<li class="toctree-l3"><a class="reference internal" href="#raspberry-pi-configuration-settings">Raspberry Pi Configuration Settings</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#installing-python-and-some-libraries">Installing python and some libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="#connecting-external-devices">Connecting external devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#python-script-to-control-the-devices">Python Script to Control the Devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="#your-task">Your Task</a></li>
</ul>
</li>
</ul>
<p class="caption"><span class="caption-text">Projects:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P001/P001_info.html">Project P001</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P002/P002_info.html">Project P002</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P003/P003_info.html">Project P003</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P004/P004_info.html">Project P004</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P005/P005_info.html">Project P005</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P006/P006_info.html">Project P006</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P007/P007_info.html">Project P007</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P008/P008_info.html">Project P008</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../projects/P009/P009_info.html">Project P009</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../resources/dictionary.html">Dictionary</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../resources/reading.html">Reading</a></li>
</ul>
<p class="caption"><span class="caption-text">Teacher Guide:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../guide/guide.html">Guide</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">INTEGRATE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>P3-E201</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../../_sources/exercises/E201/E201.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="p3-e201">
<h1>P3-E201<a class="headerlink" href="#p3-e201" title="Permalink to this headline">¶</a></h1>
<p>The objective of this exercise is to introduce you to a practical approach for collecting atmospheric data by using efficient and inexpensive devices with the goal of obtaining programming skills as well. However, basic command line skills are required but not entirely necessary to complete this exercise. This tutorial requires no previous knowledge of programming and experience with Raspberry Pi. It has been designed to allow everyone to successfully complete the exercise without difficulties in understanding an of the steps. We will be building a small weather station with BME280 sensor connected to a Raspberry Pi Zero W with a small OLED screen attached to display the reading from the sensor. Note that any version of Raspberry Pi can be used for this exercise and the purpose can also be equally achieved without the use of OLED screen. Raspberry Pi is a small single-board (like credit card) computer that are used for many practical projects especially for young people with the goal of learning programming and hardware skills (for more details, go to official site for Raspberry Pi). It will be used in this exercise as a minicomputer to control an electronic sensor and OLED display screen. Moreover, BME28O device developed by Bosch (Bosch site contains all the technical details) will be used as a digital barometric pressure sensor that measures temperature, pressure and humidity. After completing this exercise, you should be conversant in assembling and programming (using python) weather and environmental sensing system on Raspberry Pi.</p>
<div class="section" id="information">
<h2>Information<a class="headerlink" href="#information" title="Permalink to this headline">¶</a></h2>
<table class="docutils align-default">
<colgroup>
<col style="width: 28%" />
<col style="width: 72%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head" colspan="2"><p>Learning goals</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><strong>Concepts</strong></p></td>
<td><ul class="simple">
<li><p>atmospheric measurement systems</p></li>
<li><p>automated recordings</p></li>
<li><p>basic electronics</p></li>
</ul>
</td>
</tr>
<tr class="row-odd"><td><p><strong>Skills</strong></p></td>
<td><ul class="simple">
<li><p>work with a Raspberry Pi</p></li>
<li><p>create a simply atmospheric measurement system</p></li>
<li><p>collect your own data</p></li>
</ul>
</td>
</tr>
</tbody>
</table>
<div class="topic">
<p class="topic-title">What to Submit</p>
<p>Submit a short (~2 pages) summary of the steps you have taken to assemble and programme the Raspberry Pi. Also submit the script you wrote to create (and plot) records of your measurements.</p>
</div>
</div>
<div class="section" id="setting-up-the-raspberry-pi">
<h2>Setting up the Raspberry Pi<a class="headerlink" href="#setting-up-the-raspberry-pi" title="Permalink to this headline">¶</a></h2>
<p>This section will introduce you to the hardware devices and software package required to complete this exercise. We will setup the Pi software on the computer with some initial settings that are required for the other devices. Follow the steps carefully and do not forget to read the referenced sites for more information.</p>
<div class="section" id="requirements">
<h3>Requirements<a class="headerlink" href="#requirements" title="Permalink to this headline">¶</a></h3>
<div class="figure align-center" id="id1" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig1.jpg"><img alt="../../_images/fig1.jpg" src="../../_images/fig1.jpg" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Parts of Raspberry Pi Zero W</span><a class="headerlink" href="#id1" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Hardware</strong></p>
<ul class="simple">
<li><p>Raspberry Pi computer will all accessories (SD card, power cable, HDMI adaptor, USB micro connector)</p></li>
<li><p>Monitor with HDMI port and cable</p></li>
<li><p>USB hub (with at least 2 slots, optional)</p></li>
<li><p>USB Keyboard and mouse</p></li>
</ul>
<p><strong>Software</strong></p>
<ul class="simple">
<li><p>Raspberry Pi OS</p></li>
</ul>
</div>
<div class="section" id="installing-raspberry-os">
<h3>Installing Raspberry OS<a class="headerlink" href="#installing-raspberry-os" title="Permalink to this headline">¶</a></h3>
<p>First, download OS product (with desktop is recommended for new users) from the Raspi OS site and unzip the downloaded folder. Use OS image flasher on your personal desktop to flash the downloaded image of the OS product onto an empty micro-SD card. If you do not have image flasher already installed on your computer, the “balenaEtcher” can easily be download from this site Etcher software (for windows/Linux/MacOS) and then install for flashing the OS image. After getting the Raspbian installed on SD card, insert it into the Raspberry Pi via the SD card slot.</p>
<div class="figure align-center" id="id2" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig2.jpg"><img alt="../../_images/fig2.jpg" src="../../_images/fig2.jpg" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">View of after installing the balenaEtcher software on your personal computer.</span><a class="headerlink" href="#id2" title="Permalink to this image">¶</a></p>
</div>
<p>Second, connect the Raspberry Pi to your monitor via the HDMI port, to power supply via the micro-USB power connector and to USB hub via the micro-USB connector. Then connect your keyboard and mouse to the USB hub. However, in case USB hub is not available, you can connect a keyboard directly to the micro-USB connector which means that everything will have to be controlled with the keyboard. If you have well experienced with command line syntax, then a mouse is mostly not required but recommended. After setting everything up, switch on the power supply to get the Raspbian running. You will see a red light blinking on the Raspberry Pi and the graphical display of the desktop screen will show on your monitor after booting the system up. The next step is to setup the software and connect internet via Wi-Fi. Normally the welcome screen of the Raspbian application is to guide you through how to set up the system. Follow the pop-up window to set the language, country and time zone. On the next step, it is always recommended to change the default password on the Pi for security reasons. Use next section of the welcome to Raspberry Pi window to change the default “pi” user account password which is “raspberry” to your new password (make sure you know it well). Use the next section to connect it to Wi-Fi by selecting your Wi-Fi name and enter the security password. In case you are in environment where further installations are required, its better to get help on how to set up the specific Wi-Fi on a Linux environment (e.g., “Eduroam” in many universities in Germany). If you are using a Pi version that has ethernet cable, then direct connection will give you access to internet without the Wi-Fi setup. Finally, use the last wizard to check for any updates and reboot the to finish the set up.</p>
<div class="figure align-center" id="id3" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig3.jpg"><img alt="../../_images/fig3.jpg" src="../../_images/fig3.jpg" style="width: 600px;" /></a>
<p class="caption"><span class="caption-text">Desktop view after booting the Raspbian software on the Pi.</span><a class="headerlink" href="#id3" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="raspberry-pi-configuration-settings">
<h3>Raspberry Pi Configuration Settings<a class="headerlink" href="#raspberry-pi-configuration-settings" title="Permalink to this headline">¶</a></h3>
<p>This step will introduce you to further configuration setting required to connect the devices and also to enable you to access your Pi remotely. The electronic sensor and OLED screen use I2C interface to communicate with the Pi, therefore it must be enabled since it is disabled by default. More specifically, I2C is a multi-device bus utilized to connect low-speed peripherals to computer and embedded systems. On the Raspberry Pi, its interface can be connected using additional pins on the GPIO header. On the other hand, we will enable the Secure Shell (SSH) interface to connect the Pi remotely (using command line) since we do not want to connect the whole setup to a monitor before we can access the data recorded by the sensor. Alternatively, we will enable Virtual Network Computing (VNC) interface if we want to access the graphical user interface of the Pi on your personal computers.</p>
<p><strong>Method 1</strong>
Using <strong>“raspi-config”</strong> on command line/terminal
You can locate the terminal on the menu bar, and you can start running the following command:</p>
<p>&gt;&gt; <strong>sudo raspi-config</strong></p>
<p>This will display the raspi-config utility window. Select the <strong>“interfacing Options”</strong>.</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig4.jpg"><img alt="../../_images/fig4.jpg" src="../../_images/fig4.jpg" style="width: 600px;" /></a>
</div>
<p>Then select I2C on P5 and select “Yes” to activate.  Repeat the same steps for VNC (P3) and SSH (P2) to activate them as well. In the end, when prompted to reboot now, click Yes to enable the activated interfaces.</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig5.jpg"><img alt="../../_images/fig5.jpg" src="../../_images/fig5.jpg" style="width: 600px;" /></a>
</div>
<p><strong>Method 2</strong>
Using the graphical interface to activate the interfaces.
When the Raspberry Pi boots to the desktop view, you can click on Menu &gt; Preferences &gt; Raspberry Pi Configuration</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig6.jpg"><img alt="../../_images/fig6.jpg" src="../../_images/fig6.jpg" style="width: 600px;" /></a>
</div>
<p>Then you can select interfaces tab and select I2C, VNC, and SSH to Enabled.</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig7.jpg"><img alt="../../_images/fig7.jpg" src="../../_images/fig7.jpg" style="width: 600px;" /></a>
</div>
<p>After that click on OK and if asked to reboot select Yes to activate the interface for the system
To learn how to access Raspberry Pi remotely via SSH or VNC, follow the detailed tutorial on raspberry pi website for SSH connection  and VNC connection, respectively.</p>
</div>
</div>
<div class="section" id="installing-python-and-some-libraries">
<h2>Installing python and some libraries<a class="headerlink" href="#installing-python-and-some-libraries" title="Permalink to this headline">¶</a></h2>
<p>The latest Raspbian software sometimes comes with python3 already installed. So, we will update it if installed or install it if it does not work for you.</p>
<p>Run the following commands for standard updates on the terminal:</p>
<p>&gt;&gt; <strong>sudo apt-get update</strong></p>
<p>&gt;&gt; <strong>sudo apt-get upgrade</strong></p>
<p>&gt;&gt; <strong>sudo pip3 install –upgrade setuptools</strong></p>
<p>If it does not work, then try to install with:</p>
<p>&gt;&gt; <strong>sudo apt-get install python3-pip</strong></p>
<p>Installing libraries required for controlling the bme280 and ssd1306 OLED screen.</p>
<p>We will be using pip3 to install all the required library (with sudo permission, which is sometimes not required).</p>
<p>Run the following commands on the terminal to install the libraries that will be used in the script for this exercise.
Install i2c bus to monitor parameters from the GPIO board (check the SMBus site for more details) and BME280 python package to control the electronic sensor(check RPi.bme280 site for more details). Alternatively, Adafruit_CircuitPython_BME280 can also be used if you are experienced with their products.</p>
<p>&gt;&gt; <strong>sudo pip3 install smbus2</strong></p>
<p>&gt;&gt; <strong>sudo pip3 install RPi.bme280</strong></p>
<p>We will use adafruit-ssd1306 (Adafruit_CircuitPython_SSD1305 official site) and Python Imaging Library (PIL official site ) to draw the text unto the OLED screen with customized fonts. More details can be found the internet by just googling them.</p>
<p>&gt;&gt; <strong>sudo pip3 install adafruit-circuitpython-ssd1306</strong></p>
<p>&gt;&gt; <strong>sudo apt-get install python-pil</strong></p>
<p>We will use openpyxl to store the data in a created excel file on the desktop to keep track of all the reading from the sensor at a specific time.</p>
<p>&gt;&gt; <strong>sudo pip3 install openpyxl</strong></p>
<p>After installing all the python libraries, reboot the Pi to get them ready to be installed.</p>
</div>
<div class="section" id="connecting-external-devices">
<h2>Connecting external devices<a class="headerlink" href="#connecting-external-devices" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will connect all the hardware together. As already mentioned, we will use BME280 sensor and OLED screen to connect to our Raspberry Pi. To be able to connect them together, we will need the following:</p>
<ol class="arabic simple">
<li><p>Electronic circuit test breadboard</p></li>
</ol>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig8.jpg"><img alt="../../_images/fig8.jpg" src="../../_images/fig8.jpg" style="width: 400px;" /></a>
</div>
<ol class="arabic simple" start="2">
<li><p>Jumper cables (both female to male, male to male connections wires)</p></li>
</ol>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig9.jpg"><img alt="../../_images/fig9.jpg" src="../../_images/fig9.jpg" style="width: 400px;" /></a>
</div>
<p>3. Soldering machine (if the sensor or screen are not already joined to their connecting pins)
First thing is to solder the pins to their connecting slots on the two devices. However, it is advisable to purchase them already solder together in order to skip this step. If you are interested in practising soldering, then it will be good to try this step too, but I can promise is challenging on the first attempt if you are not taught properly.
The next step is to connect the Raspberry Pi’s GPIO header to the two I2C devices (when the Raspberry Pi is switch off). Multi-I2C devices connection is mostly not straight forward, so we will adopt a different approach as it would have been dealing with a single I2C wiring. Note that the two devices will get different address on the board, therefore, make sure the wiring is done correctly. I2C devices normally have four pins to be join to the GPIO header pins (i.e., VCC, GND, SCL, and SDA). So, we connect one of the devices using all the four pins and then connect I2C pins (SCL and SDA) to the other device using a close circuit on the breadboard as shown in the following steps:</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig10.jpg"><img alt="../../_images/fig10.jpg" src="../../_images/fig10.jpg" style="width: 600px;" /></a>
</div>
<ol class="arabic simple">
<li><p>Place sensor and screen on the same line on the breadboard (example as on the f line as shown in the picture below).</p></li>
</ol>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig11.jpg"><img alt="../../_images/fig11.jpg" src="../../_images/fig11.jpg" style="width: 400px;" /></a>
</div>
<ol class="arabic simple" start="2">
<li><p>Use the female-male connection cables (4) to join one of the devices (e.g., bme280) to GPIO header by using the table below (use the GPIO header guide to locate the exact pins).</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 33%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>GPIO Header Pins</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VCC</p></td>
<td><p>3.3V</p></td>
<td><p>P-01</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>Ground</p></td>
<td><p>P-06</p></td>
</tr>
<tr class="row-even"><td><p>SCL</p></td>
<td><p>12C SCL</p></td>
<td><p>P-05</p></td>
</tr>
<tr class="row-odd"><td><p>SDA</p></td>
<td><p>12C SDA</p></td>
<td><p>P-03</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig12.jpg"><img alt="../../_images/fig12.jpg" src="../../_images/fig12.jpg" style="width: 400px;" /></a>
</div>
<ol class="arabic simple" start="3">
<li><p>Use female-male connection cables (2) to connect the power (VCC) and ground (GND) of the other device (e.g., OLED screen) to the GPIO header pins using the table below.</p></li>
</ol>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 30%" />
<col style="width: 33%" />
<col style="width: 37%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Module</p></th>
<th class="head"><p>Description</p></th>
<th class="head"><p>GPIO Header Pins</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>VCC</p></td>
<td><p>3.3V</p></td>
<td><p>P-01</p></td>
</tr>
<tr class="row-odd"><td><p>GND</p></td>
<td><p>Ground</p></td>
<td><p>P-06</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig13.jpg"><img alt="../../_images/fig13.jpg" src="../../_images/fig13.jpg" style="width: 400px;" /></a>
</div>
<ol class="arabic simple" start="4">
<li><p>Use the male-male connection cables (2) to connect the SDA (e.g., on the “i” line) and SCL (e.g., on the “j” line) from the first device to the second device using the same line to close the circuit. Make sure a single line is used to connect each of the I2C pins.</p></li>
</ol>
<div class="figure align-center" style="width: 400px">
<a class="reference internal image-reference" href="../../_images/fig14.jpg"><img alt="../../_images/fig14.jpg" src="../../_images/fig14.jpg" style="width: 400px;" /></a>
</div>
<ol class="arabic simple" start="5">
<li><p>Check if all your device is connected by switching on the Raspberry Pi and run the following i2cdetect command to return the addresses for each of the devices on the terminal:</p></li>
</ol>
<p>&gt;&gt; i2cdetect -y 1</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig15.jpg"><img alt="../../_images/fig15.jpg" src="../../_images/fig15.jpg" style="width: 600px;" /></a>
</div>
<ol class="arabic simple" start="6">
<li><p>When everything works, you will see two addresses (0x76 for bme280 and 0x3c for OLED screen, or something similar). Write the address down for the next section.</p></li>
</ol>
</div>
<div class="section" id="python-script-to-control-the-devices">
<h2>Python Script to Control the Devices<a class="headerlink" href="#python-script-to-control-the-devices" title="Permalink to this headline">¶</a></h2>
<p>In this section, we will now write our first python script to control the device. The latest Raspbian software has “Thonny python IDE” installed by default and we will use it in this exercise. Alternatively, other text editors can also be used to write the python script and execute from the command line. The Thonny python IDE can be accessed on Raspberry Pi through Menu &gt; Programming &gt; Thonny Python IDE</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig16.jpg"><img alt="../../_images/fig16.jpg" src="../../_images/fig16.jpg" style="width: 600px;" /></a>
</div>
<p>It has the code editor area (with some scripts displayed), shell or interpreter prompt and variable window to show your implemented variables.</p>
<div class="figure align-center" style="width: 600px">
<a class="reference internal image-reference" href="../../_images/fig17.jpg"><img alt="../../_images/fig17.jpg" src="../../_images/fig17.jpg" style="width: 600px;" /></a>
</div>
<p>Now we will write a script that measures the atmospheric variables on a time interval (e.g., 1 minute interval), then store in a generated excel file and at the same time displays on the OLED screen with the time and date. Note that there are many ways to arrive at the same point in this exercise, therefore, you are allowed to adjust this script as you like. We will go through importing all the modules, calibrating sensor to take readings, setting OLED screen to display readings and saving the data in an excel sheet.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">author: daniel boateng (dannboateng@gmail.com)</span>
<span class="sd">This script basically controls the measurement from BME280 sensor, store in an excel sheet (with defined columns for date, time, temperature,</span>
<span class="sd">humidity and pressure. Not that other parmaters like dewpoint temperature can be calculated from these parameters) and also displays the date</span>
<span class="sd">and time on attached oled screen for each measurement.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c1"># The first part of the script is to import all the modules we installed at the previous section required for the devices. In python, </span>
<span class="c1"># &quot;import&quot; is used to call a package in current script. </span>

<span class="c1">#importing modules </span>
<span class="kn">import</span> <span class="nn">smbus2</span>
<span class="kn">import</span> <span class="nn">bme280</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">date</span>
<span class="kn">from</span> <span class="nn">openpyxl</span> <span class="k">import</span> <span class="n">load_workbook</span>
<span class="kn">import</span> <span class="nn">board</span>
<span class="kn">import</span> <span class="nn">busio</span>
<span class="kn">import</span> <span class="nn">digitalio</span>
<span class="kn">import</span> <span class="nn">adafruit_ssd1306</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="k">import</span> <span class="n">Image</span><span class="p">,</span> <span class="n">ImageDraw</span><span class="p">,</span> <span class="n">ImageFont</span>


<span class="c1"># We will set the bme280 object in order use its functions for measurement</span>

<span class="c1"># define I2C port (normally, I2C has 2 ports (i.e., I2C0, I2C1)). So if you use &quot;i2cdetect -y 1&quot; to check  </span>
<span class="c1"># address of your device, then the devices are on port 1. Likewise &quot;i2cdetect -y 0&quot; if they are connected to port 0</span>
<span class="n">port</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># define the address of sensor (as explained from the previous section using &quot;i2cdetect&quot;)</span>
<span class="n">address</span> <span class="o">=</span> <span class="mh">0x76</span>

<span class="c1"># define SMbus instance for controlling the board</span>
<span class="n">bus</span> <span class="o">=</span> <span class="n">smbus2</span><span class="o">.</span><span class="n">SMBus</span><span class="p">(</span><span class="n">port</span><span class="p">)</span>

<span class="c1"># Now we will calibrate the sensor using the load_calibrations function, which is attribute of bme280 module</span>
<span class="c1"># by using the bus and address as input parameters</span>
<span class="n">calibration_params</span> <span class="o">=</span> <span class="n">bme280</span><span class="o">.</span><span class="n">load_calibration_params</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">address</span><span class="p">)</span>

<span class="c1"># define data class to calculate the readings from the sensor (with the calibrated params)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">bme280</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">bus</span><span class="p">,</span> <span class="n">address</span><span class="p">,</span> <span class="n">calibration_params</span><span class="p">)</span>

<span class="c1"># Now each variable can be obtained from the &quot;data class&quot; by calling variable method. But we will take the </span>
<span class="c1"># firt readings and ignore it since it might not be correct. Then after 1 seconds (this can be increased)</span>
<span class="c1"># the correct readings can be recored on a specific interval.</span>
<span class="n">temperature</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">temperature</span>
<span class="n">pressure</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">pressure</span>
<span class="n">humidity</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">humidity</span>

<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>   <span class="c1"># time interval to wait after the first reading</span>

<span class="c1"># setting OLED screen </span>

<span class="c1"># define reset pins by using digit input and output (the board can be any number eg. D5, D6..)</span>
<span class="n">oled_reset</span> <span class="o">=</span> <span class="n">digitalio</span><span class="o">.</span><span class="n">DigitalInOut</span><span class="p">(</span><span class="n">board</span><span class="o">.</span><span class="n">D4</span><span class="p">)</span>

<span class="c1"># define the right size of your display. Please change it depending on your display size (eg. 128x32)</span>
<span class="n">WIDTH</span> <span class="o">=</span> <span class="mi">128</span>
<span class="n">HEIGHT</span> <span class="o">=</span> <span class="mi">64</span>
<span class="n">BORDER</span> <span class="o">=</span> <span class="mi">5</span>

<span class="c1"># define I2C</span>
<span class="n">i2c</span> <span class="o">=</span> <span class="n">board</span><span class="o">.</span><span class="n">I2C</span><span class="p">()</span>

<span class="c1"># define the oled display class (using the address and defined paramters)</span>
<span class="n">oled</span> <span class="o">=</span> <span class="n">adafruit_ssd1306</span><span class="o">.</span><span class="n">SSD1306_I2C</span><span class="p">(</span><span class="n">WIDTH</span><span class="p">,</span> <span class="n">HEIGHT</span><span class="p">,</span> <span class="n">i2c</span><span class="p">,</span> <span class="n">addr</span><span class="o">=</span><span class="mh">0x3c</span><span class="p">,</span> <span class="n">reset</span><span class="o">=</span><span class="n">oled_reset</span><span class="p">)</span>


<span class="c1"># Now lets clear the display first</span>
<span class="n">oled</span><span class="o">.</span><span class="n">fill</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">oled</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># customizing the screen specifications (we are using default here)</span>
<span class="n">width</span> <span class="o">=</span> <span class="n">oled</span><span class="o">.</span><span class="n">width</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">oled</span><span class="o">.</span><span class="n">height</span>

<span class="c1"># now create blank image to draw your text on it. Not that &quot;1&quot; is for 1-bit color</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">Image</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s2">&quot;1&quot;</span><span class="p">,</span> <span class="p">(</span><span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">))</span>

<span class="c1">#define object for drawing on the image </span>
<span class="n">draw</span> <span class="o">=</span><span class="n">ImageDraw</span><span class="o">.</span><span class="n">Draw</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

<span class="c1"># define a black backgroud to draw the image on (note you can use 225 for fill and outline</span>
<span class="c1"># for white background)</span>
<span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">outline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># define the positon of the text</span>
<span class="n">padding</span><span class="o">=-</span><span class="mi">2</span>
<span class="n">top</span><span class="o">=</span><span class="n">padding</span>
<span class="n">bottom</span><span class="o">=</span><span class="n">height</span><span class="o">-</span><span class="n">padding</span>
<span class="n">x</span><span class="o">=</span><span class="mi">0</span>

<span class="c1">#define font type (we used default here, you can google it for other styles)</span>
<span class="n">font</span> <span class="o">=</span> <span class="n">ImageFont</span><span class="o">.</span><span class="n">load_default</span><span class="p">()</span>

<span class="c1">#saving data</span>

<span class="c1"># Now we will load the excel file created on Desktop into memory by using the load_workbook from openpyxl</span>

<span class="n">wb</span> <span class="o">=</span> <span class="n">load_workbook</span><span class="p">(</span><span class="s2">&quot;/home/pi/Desktop/Reading_from_bme280.xlsx&quot;</span><span class="p">)</span>
<span class="n">sheet</span> <span class="o">=</span> <span class="n">wb</span><span class="p">[</span><span class="s2">&quot;Sheet1&quot;</span><span class="p">]</span>

<span class="c1"># Now we will write a loop to continue the measurement until we stop by pressing Ctrl + C</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Please to end the readings from the sensor, kindly press Ctrl + C&quot;</span><span class="p">)</span> <span class="c1"># print it for new users to know</span>

<span class="c1"># So this loop will run until you interupt it (But you can also define it to stop after certain time)</span>
<span class="k">try</span><span class="p">:</span>

    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">rectangle</span><span class="p">((</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span> <span class="n">width</span><span class="p">,</span> <span class="n">height</span><span class="p">),</span> <span class="n">outline</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># taking readings from the data class and rounding it once decimal place</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">temperature</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">pressure</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">pressure</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">humidity</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">humidity</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># check date for measuring </span>
        <span class="n">today</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">today</span><span class="p">()</span>

        <span class="c1"># time of measurement</span>
        <span class="n">now</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Adding data to the spreadsheet&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">today</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">°C </span><span class="si">{}</span><span class="s2">hPa </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">humidity</span><span class="p">))</span>
        
        <span class="c1"># define the data to be stored in the excel fine on each row (so define the excel as similar !!)</span>
        <span class="n">row</span> <span class="o">=</span> <span class="p">(</span><span class="n">today</span><span class="p">,</span> <span class="n">now</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">humidity</span><span class="p">)</span>
        <span class="n">sheet</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
        <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/home/pi/Desktop/Reading_from_bme280.xlsx&quot;</span><span class="p">)</span>  <span class="c1"># saving after each measurement</span>

   
        <span class="c1"># drawing text on the screen with their positions</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">top</span><span class="o">+</span><span class="mi">0</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">today</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">top</span><span class="o">+</span><span class="mi">20</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">now</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">draw</span><span class="o">.</span><span class="n">text</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">top</span><span class="o">+</span><span class="mi">40</span><span class="p">),</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">°C </span><span class="si">{}</span><span class="s2">hPa </span><span class="si">{}</span><span class="s2">%&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">temperature</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">humidity</span><span class="p">),</span> <span class="n">font</span><span class="o">=</span><span class="n">font</span><span class="p">,</span> <span class="n">fill</span><span class="o">=</span><span class="mi">255</span><span class="p">)</span>
        <span class="n">oled</span><span class="o">.</span><span class="n">image</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
        <span class="n">oled</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="c1"># define waiting time after each measurement (eg. 60 seconds)</span>
        <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">60</span><span class="p">)</span>

<span class="c1"># now make sure it saves everyting after stoping the reading !        </span>
<span class="k">finally</span><span class="p">:</span>
    <span class="n">wb</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;/home/pi/Desktop/Reading_from_bme280.xlsx&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Goodbye!&quot;</span><span class="p">)</span>


   
</pre></div>
</div>
</div>
<div class="section" id="your-task">
<h2>Your Task<a class="headerlink" href="#your-task" title="Permalink to this headline">¶</a></h2>
<p>In groups of 2-4, assemble s simple measurement system using the Rasperyy Pi and sensors provided to you. Use your programming skills to implement a script that will measure and plot your data. Document your steps carefully on 1-2 pages. Diagrams and pictures may help with the documentation.</p>
<p>Two student examples are given below:</p>
<p><a class="reference download internal" download="" href="../../_downloads/8345fcec5c5bb89602b5c6ccc58e2c9b/Julia.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Julias</span> <span class="pre">Hemmlig's</span> <span class="pre">Guide</span></code></a></p>
<p><a class="reference download internal" download="" href="../../_downloads/dc670dfbd6fc11884e2874cd7cbd376a/Noam.pdf"><code class="xref download docutils literal notranslate"><span class="pre">Noam</span> <span class="pre">Poremba's</span> <span class="pre">Guide</span></code></a></p>
<p>In addition to your documentation, create simple time series plots of measurements you have taken.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Late submissions won’t be accepted!</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../projects/P001/P001_info.html" class="btn btn-neutral float-right" title="Project P001" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../E105/E105.html" class="btn btn-neutral float-left" title="P2-E005" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2021, Sebastian G. Mutz
      <span class="lastupdated">
        Last updated on May 08, 2021.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>